
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exercise 1: Compute Total Energies for Water with MultiWavelets</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_lesson.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/minipres.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Exercise 3: Compute NMR Shielding Constants and Magnetizibility for a Transition Metal Complex" href="../mrchem-hpc/" />
    <link rel="prev" title="VAMPyR SCF exercise goes here" href="../vampyr-scf/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/hylleraas-logo.png" class="logo" alt="logo">
      
      
    </a>
</div><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../">
   Multiwavelet tutorial
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../setup/">
   Setting up your system
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Exercises
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../vampyr-intro/">
   VAMPyR introduction goes here
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../vampyr-scf/">
   VAMPyR SCF exercise goes here
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Exercise 1: Compute Total Energies for Water with MultiWavelets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mrchem-hpc/">
   Exercise 3: Compute NMR Shielding Constants and Magnetizibility for a Transition Metal Complex
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/mrchem-laptop.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/MRChemSoft/multiwavelet-tutorial"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/MRChemSoft/multiwavelet-tutorial/issues/new?title=Issue%20on%20page%20%2Fnotebooks/mrchem-laptop.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/MRChemSoft/multiwavelet-tutorial/edit/master/content/notebooks/mrchem-laptop.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/MRChemSoft/multiwavelet-tutorial/master?urlpath=lab/tree/content/notebooks/mrchem-laptop.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Exercise 1: Compute Total Energies for Water with MultiWavelets
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactive-3d-viewer-for-the-water-molecule">
     Interactive 3D viewer for the water molecule
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-call-mrchem">
     How to call MRChem
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-mrchem-input-file">
     The MRChem input file
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computational-details">
     Computational details
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instructions">
     Instructions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-2-compute-nmr-shielding-constants-for-water-with-multiwavelets">
   Exercise 2: Compute NMR Shielding Constants for Water with MultiWavelets
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     The MRChem input file
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Computational details
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Instructions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convenience-scripts">
   Convenience scripts
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="exercise-1-compute-total-energies-for-water-with-multiwavelets">
<h1>Exercise 1: Compute Total Energies for Water with MultiWavelets<a class="headerlink" href="#exercise-1-compute-total-energies-for-water-with-multiwavelets" title="Permalink to this headline">¶</a></h1>
<p>Below you will find links to all all the relevant pages of the MRChem documentation. Please refer to these if you need more details on how to set up the calculations.</p>
<p><a class="reference external" href="https://mrchem.readthedocs.io/en/latest/"><img src="https://img.shields.io/badge/Documentation-Main_Page-orange.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/installation.html"><img src="https://img.shields.io/badge/I_Need_Help-Installation-teal.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/running.html"><img src="https://img.shields.io/badge/I_Need_Help-How_To_Run-green.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/user_inp.html"><img src="https://img.shields.io/badge/I_Need_Help-Input_Quick_Guide-blue.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/user_ref.html"><img src="https://img.shields.io/badge/I_Need_Help-Input_Reference-purple.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/program_json.html"><img src="https://img.shields.io/badge/I_Need_Help-JSON_Output-red.svg?logo=LOGO"></a></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this exercise you will use the MRChem code to perform simple energy optimizations of a water molecule, using different MultiWavelet precision levels.</p>
<p>You can fill your values into the empty table below to store your results. The GTO calclations have already been performed with the Dalton code, and can serve as a comparison.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">MWn</span></code> notation is a shorthand for a relative precision of <code class="docutils literal notranslate"><span class="pre">1.0e-n</span></code>, and is commonly used to refer to calculations of different precisions (analogous to the DZ, TZ, QZ… notation for GTO basis sets).</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Basis</p></th>
<th class="head"><p>Energy</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MW3</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>MW4</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>MW5</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>DZ</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>TZ</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>QZ</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<hr class="docutils" />
<div class="section" id="interactive-3d-viewer-for-the-water-molecule">
<h2>Interactive 3D viewer for the water molecule<a class="headerlink" href="#interactive-3d-viewer-for-the-water-molecule" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">py3Dmol</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">py3Dmol</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;geometries/water.xyz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">view</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s1">&#39;stick&#39;</span><span class="p">:</span> <span class="p">{}})</span>
<span class="n">view</span><span class="o">.</span><span class="n">zoomTo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_1634215065503671"  style="position: relative; width: 200px; height: 200px">
        <p id="3dmolwarning_1634215065503671" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://3dmol.org/build/3Dmol.js');
}

var viewer_1634215065503671 = null;
var warn = document.getElementById("3dmolwarning_1634215065503671");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_1634215065503671 = $3Dmol.createViewer($("#3dmolviewer_1634215065503671"),{backgroundColor:"white"});
viewer_1634215065503671.zoomTo();
	viewer_1634215065503671.addModel("3\nWater_pbe\nO -7.515506 0.484824 3.657893\nH -8.283582 -0.077847 3.449409\nH -7.066811 -0.032497 4.351478");
	viewer_1634215065503671.setStyle({"stick": {}});
	viewer_1634215065503671.zoomTo();
viewer_1634215065503671.render();
});
</script></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;py3Dmol.view at 0x7f82a8f5f610&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-call-mrchem">
<h2>How to call MRChem<a class="headerlink" href="#how-to-call-mrchem" title="Permalink to this headline">¶</a></h2>
<p>Open a new Jupyter Lab terminal by from the Jupyter Launcher (blue button with white “+”).
This works like any other linux terminal, and you can edit input files and look at output files here to complete the exercise.</p>
<p>MRChem with OpenMP parallelization should already be pre-installed from our conda distribution.
In order to start an MRChem calculation, you just call the input parser (<code class="docutils literal notranslate"><span class="pre">mrchem</span></code>) from the command line like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">OMP_NUM_THRADS</span><span class="o">=</span><span class="m">16</span>
mrchem jobname.inp
</pre></div>
</div>
<p>This will parse the <em>user</em> input file (<code class="docutils literal notranslate"><span class="pre">jobname.inp</span></code>) and generate a <em>program</em> input file in JSON format (<code class="docutils literal notranslate"><span class="pre">jobname.json</span></code>), and then pass the program input to the binary MRChem executable and redirect <code class="docutils literal notranslate"><span class="pre">stdout</span></code> to the output file (<code class="docutils literal notranslate"><span class="pre">jobname.out</span></code>). The output is also stored in <code class="docutils literal notranslate"><span class="pre">jobname.json</span></code> in JSON format in a separate output section, and this file serves as a complete record of the calculation (including both the input and output). In the example above, MRChem will use 16 threads as defined in the <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code> environment variable.</p>
</div>
<hr class="docutils" />
<div class="section" id="the-mrchem-input-file">
<h2>The MRChem input file<a class="headerlink" href="#the-mrchem-input-file" title="Permalink to this headline">¶</a></h2>
<p>Below is an outline of an MRChem input for a simple energy optimization at the MW3 precision level.
Try to use the documentation pages to find the relevant keywords for setting up the calculation.
If you need additional help, don’t hesitate to ask :)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>world_prec = 1.0e-3
world_unit = angstrom

Molecule {
  $coords
  ...
  $end
}

WaveFunction {
}

SCF {
}

</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="computational-details">
<h2>Computational details<a class="headerlink" href="#computational-details" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The GTO results were computed with the PBE functional, and so you should also use PBE if the results are to comparable.</p></li>
<li><p>An optimized geometry of water is supplied in <code class="docutils literal notranslate"><span class="pre">./geometries/water.xyz</span></code>.</p></li>
<li><p>Use a KAIN SCF accelerator history of 5.</p></li>
<li><p>Make sure the SCF <code class="docutils literal notranslate"><span class="pre">max_iter</span></code> option is large enough (20 should be plenty).</p></li>
<li><p>As starting guess, <code class="docutils literal notranslate"><span class="pre">sad_dz</span></code> works well.</p></li>
</ul>
<blockquote>
<div><p><strong>Note</strong>
Input blocks are case sensitive, while keywords inside blocks are not</p>
</div></blockquote>
</div>
<hr class="docutils" />
<div class="section" id="instructions">
<h2>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Generate the input files necessary to fill in the missing data in the table above. You can either do this in your favorite command line text editor, or write Python scripts from within the notebook.</p></li>
<li><p>Submit the calculations as described above.</p></li>
<li><p>You are encouraged to take a look at the output file (<code class="docutils literal notranslate"><span class="pre">jobname.out</span></code>) to look at the information printed here, and also to check out the JSON output file (<code class="docutils literal notranslate"><span class="pre">jobname.json</span></code>) to see the same output in a very scripting friendly format.</p></li>
<li><p>Extract the relevant information from either the <code class="docutils literal notranslate"><span class="pre">jobname.out</span></code> file or the <code class="docutils literal notranslate"><span class="pre">jobname.json</span></code> file, and fill out the table above.</p></li>
<li><p>Using the MW5 data as a reference, compute the basis set errors for the other methods. Try to visualize these either as a table or by plotting the errors.</p></li>
</ol>
</div>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="exercise-2-compute-nmr-shielding-constants-for-water-with-multiwavelets">
<h1>Exercise 2: Compute NMR Shielding Constants for Water with MultiWavelets<a class="headerlink" href="#exercise-2-compute-nmr-shielding-constants-for-water-with-multiwavelets" title="Permalink to this headline">¶</a></h1>
<p>Below you will find links to all all the relevant pages of the MRChem documentation. Please refer to these if you need more details on how to set up the calculations.</p>
<p><a class="reference external" href="https://mrchem.readthedocs.io/en/latest/"><img src="https://img.shields.io/badge/Documentation-Main_Page-orange.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/installation.html"><img src="https://img.shields.io/badge/I_Need_Help-Installation-teal.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/running.html"><img src="https://img.shields.io/badge/I_Need_Help-How_To_Run-green.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/user_inp.html"><img src="https://img.shields.io/badge/I_Need_Help-Input_Quick_Guide-blue.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/user_ref.html"><img src="https://img.shields.io/badge/I_Need_Help-Input_Reference-purple.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/program_json.html"><img src="https://img.shields.io/badge/I_Need_Help-JSON_Output-red.svg?logo=LOGO"></a></p>
<div class="section" id="id1">
<h2>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>In this exercise you will use the MRChem code to compute NMR shielding constants for a water molecule, using the linear response implementation.</p>
<p>You can store your results in the empty tables below. The GTO calclations have already been performed with the Dalton code, and can serve as a comparison.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">MWn</span></code> notation is a shorthand for a relative precision of <code class="docutils literal notranslate"><span class="pre">1.0e-n</span></code>, and is commonly used to refer to calculations of different precisions (analogous to the DZ, TZ, QZ… notation for GTO basis sets).</p>
<div align="center"> Table 1. NMR shielding constants for the Hydrogen atom.</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>H-atom</p></th>
<th class="head"><p>Origin&#64;H</p></th>
<th class="head"><p>Origin&#64;Cl</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MW3</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>MW4</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>MW5</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>DZ</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>TZ</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>QZ</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<div align="center">Table 2. NMR shielding constants for the Chlorine atom.</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Cl-atom</p></th>
<th class="head"><p>Origin&#64;H</p></th>
<th class="head"><p>Origin&#64;Cl</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MW3</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>MW4</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>MW5</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>DZ</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>TZ</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>QZ</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<hr class="docutils" />
<div class="section" id="id2">
<h2>The MRChem input file<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Below is an outline of an MRChem input for an NMR properties calculation at the MW3 precision level.
Try to use the documentation pages to find the relevant keywords for setting up the calculation.
If you need additional help, don’t hesitate to ask :)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">world_prec</span> <span class="o">=</span> <span class="m">1</span>.0e-3
<span class="nv">world_unit</span> <span class="o">=</span> angstrom

Molecule <span class="o">{</span>
  <span class="nv">$coords</span>
  ...
  <span class="nv">$end</span>
<span class="o">}</span>

WaveFunction <span class="o">{</span>
<span class="o">}</span>

SCF <span class="o">{</span>
<span class="o">}</span>

Properties <span class="o">{</span>
<span class="o">}</span>

Response <span class="o">{</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id3">
<h2>Computational details<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The GTO results were computed with the PBE functional, and so you should also use PBE if the results are to comparable.</p></li>
<li><p>An optimized geometry of water is supplied in <code class="docutils literal notranslate"><span class="pre">./geometries/water.xyz</span></code>.</p></li>
<li><p>Use a KAIN SCF and response accelerator history of 5.</p></li>
<li><p>Make sure the SCF and response <code class="docutils literal notranslate"><span class="pre">max_iter</span></code> options are large enough (20 should be plenty).</p></li>
<li><p>As starting guess, <code class="docutils literal notranslate"><span class="pre">sad_dz</span></code> works well.</p></li>
</ul>
<blockquote>
<div><p><strong>Note</strong>
Input blocks are case sensitive, while keywords inside blocks are not</p>
</div></blockquote>
</div>
<hr class="docutils" />
<div class="section" id="id4">
<h2>Instructions<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Generate the input files necessary to fill in the missing data in the table above. You can either do this in your favorite command line text editor, or write Python scripts from within the notebook.</p></li>
<li><p>Submit the calculations as described above.</p></li>
<li><p>You are encouraged to take a look at the output file (<code class="docutils literal notranslate"><span class="pre">jobname.out</span></code>) to look at the information printed here, and also to check out the JSON output file (<code class="docutils literal notranslate"><span class="pre">jobname.json</span></code>) to see the same output in a very scripting friendly format.</p></li>
<li><p>Extract the relevant information from either the <code class="docutils literal notranslate"><span class="pre">jobname.out</span></code> file or the <code class="docutils literal notranslate"><span class="pre">jobname.json</span></code> file, and fill out the table above.</p></li>
<li><p>Using the MW5 data as a reference, compute the basis set errors for the other methods. Try to visualize these either as a table or by plotting the errors.</p></li>
</ol>
</div>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="convenience-scripts">
<h1>Convenience scripts<a class="headerlink" href="#convenience-scripts" title="Permalink to this headline">¶</a></h1>
<p>A class <code class="docutils literal notranslate"><span class="pre">MRChemOutput</span></code> is provided in the <code class="docutils literal notranslate"><span class="pre">./utils/functions.py</span></code> file to aid in fetching relevant properties from the JSON output file. In addition, it has methods for plotting the SCF convergence.</p>
<p>(You can of course also open the output files directly in the terminal and extract the data manually if you prefer.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils.functions</span> <span class="kn">import</span> <span class="n">MRChemOutput</span>

<span class="n">help</span><span class="p">(</span><span class="n">MRChemOutput</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on class MRChemOutput in module utils.functions:

class MRChemOutput(builtins.object)
 |  MRChemOutput(jsonfile)
 |  
 |  Convenience class for accessing data from an MRChem calculation.
 |  
 |  You can access the JSON data via the data attribute.
 |  For example, to get the final SCF total energy:
 |  
 |  
 |  []: calc = MRChemOutput(&#39;jobname.json&#39;)
 |      E_tot = calc.data[&#39;output&#39;][&#39;properties&#39;][&#39;scf_energy&#39;][&#39;E_tot&#39;]
 |  
 |  Additionally, the JSON is loaded as a nested SimpleNamespace
 |  (stored in the ns attribute),
 |  and you can quickly navigate the dict by &#39;dotting&#39; through
 |  the keys. Tab completion should work for this in the Jupyter
 |  environment:
 |  
 |  []: E_tot = calc.ns.output.properties.scf_energy.E_tot
 |  
 |  Known bug
 |  Some keys are not valid Python variable names,
 |  and you cannot access the levels below these keys by dotting.
 |  Workaround: use __.getattribute__(key) to access such keys.
 |  
 |  A few methods are also provided that serve as shortcuts
 |  for navigating the data dictionary, and for plotting
 |  SCF convergence data.
 |  
 |  Methods defined here:
 |  
 |  __init__(self, jsonfile)
 |      Parameters:
 |      jsonfile &lt;str&gt;: Path to MRChem output JSON file
 |  
 |  getFinalSCFEnergy(self) -&gt; float
 |      Return optimized SCF energy in Hartrees.
 |  
 |  getNMRShieldingAnisotropy(self) -&gt; dict
 |      Return anisotropy of the diagonalized NMR shielding tensor.
 |  
 |  getNMRShieldingIsotropicAverage(self) -&gt; dict
 |      Return isotropic average of total NMR shielding tensor.
 |  
 |  getNMRShieldingTensors(self) -&gt; dict
 |      Return total NMR shielding tensor.
 |  
 |  getNMRShieldingTensorsDiagonalized(self) -&gt; dict
 |      Return diagonalized total NMR shielding tensor.
 |  
 |  getNMRShieldingTensorsDiamagnetic(self) -&gt; dict
 |      Return diamagnetic contribution to NMR shielding tensor.
 |  
 |  getNMRShieldingTensorsParamagnetic(self) -&gt; dict
 |      Return paramagnetic contribution to NMR shielding tensor.
 |  
 |  getResponseConvergence(self) -&gt; list
 |      Return convergence data for the x, y, and z dimension response SCFs.
 |  
 |  getSCFConvergence(self) -&gt; list
 |      Return list of tuples containing total energy, energy update, and MO residuals
 |      for all SCF iterations.
 |  
 |  getWalltime(self)
 |  
 |  normalTermination(self)
 |  
 |  plotResponseConvergence(self)
 |      Plot the response SCF convergence in terms of the property, property update, and MO residual.
 |  
 |  plotSCFConvergence(self)
 |      Plot the SCF convergence in terms of total energy, energy udpates, and MO residuals.
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example usage</span>
<span class="n">calc</span> <span class="o">=</span> <span class="n">MRChemOutput</span><span class="p">(</span><span class="s1">&#39;utils/sample.json&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">calc</span><span class="o">.</span><span class="n">normalTermination</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Total Energy          : </span><span class="si">{</span><span class="n">calc</span><span class="o">.</span><span class="n">getFinalSCFEnergy</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Walltime (scf, rsp)   : </span><span class="si">{</span><span class="n">calc</span><span class="o">.</span><span class="n">getWalltime</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of cores       : </span><span class="si">{</span><span class="n">calc</span><span class="o">.</span><span class="n">ns</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">provenance</span><span class="o">.</span><span class="n">total_cores</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">calc</span><span class="o">.</span><span class="n">getNMRShieldingTensors</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data for </span><span class="si">{</span><span class="n">atom</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;NMR Shielding Constant Tensor:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">getNMRShieldingTensors</span><span class="p">()[</span><span class="n">atom</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diagonalized tensor:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">getNMRShieldingTensorsDiagonalized</span><span class="p">()[</span><span class="n">atom</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Isotropic average: </span><span class="si">{</span><span class="n">calc</span><span class="o">.</span><span class="n">getNMRShieldingIsotropicAverage</span><span class="p">()[</span><span class="n">atom</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anisotropy: </span><span class="si">{</span><span class="n">calc</span><span class="o">.</span><span class="n">getNMRShieldingAnisotropy</span><span class="p">()[</span><span class="n">atom</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">calc</span><span class="o">.</span><span class="n">plotSCFConvergence</span><span class="p">()</span>
    <span class="n">calc</span><span class="o">.</span><span class="n">plotResponseConvergence</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total Energy          : -76.38860224093312
Walltime (scf, rsp)   : (219.552260723, 632.477121415)
Number of cores       : 16

-----------------
Data for nmr-0o
-----------------
NMR Shielding Constant Tensor:
[[333.45507763   4.90025432  27.07415563]
 [  4.89817057 305.52973397  -4.18477744]
 [ 27.0778991   -4.18904657 317.39539311]]

Diagonalized tensor:
[353.70941619 308.86664458 293.80414394]

Isotropic average: 318.7934015701185
Anisotropy: 52.37402192835549
-----------------
Data for nmr-1h
-----------------
NMR Shielding Constant Tensor:
[[36.70696831  6.96240892  5.34287877]
 [ 8.35163703 29.35328591  2.51908401]
 [ 4.39134145  1.45676698 25.98575899]]

Diagonalized tensor:
[43.03945725 23.60335751 25.40319845]

Isotropic average: 30.682004403396633
Anisotropy: 18.536179267599437
-----------------
Data for nmr-2h
-----------------
NMR Shielding Constant Tensor:
[[29.98062936 -3.11758555  6.99741281]
 [-4.52113597 28.50172508 -6.77684658]
 [ 7.94238942 -5.70603908 33.54861924]]

Diagonalized tensor:
[43.01967517 25.40855951 23.602739  ]

Isotropic average: 30.676991229113828
Anisotropy: 18.514025914327135
</pre></div>
</div>
<img alt="../../_images/mrchem-laptop_7_1.png" src="../../_images/mrchem-laptop_7_1.png" />
<img alt="../../_images/mrchem-laptop_7_2.png" src="../../_images/mrchem-laptop_7_2.png" />
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "MRChemSoft/multiwavelet-tutorial",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../vampyr-scf/" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">VAMPyR SCF exercise goes here</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../mrchem-hpc/" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Exercise 3: Compute NMR Shielding Constants and Magnetizibility for a Transition Metal Complex</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The contributors<br/>
        
            &copy; Copyright 2021, The contributors.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>